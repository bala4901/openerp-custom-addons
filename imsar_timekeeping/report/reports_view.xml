<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <!-- Timesheet lines report -->
        <record id="view_timekeeping_lines_report_search" model="ir.ui.view">
            <field name="name">hr.timekeeping.lines.report.search</field>
            <field name="model">hr.timekeeping.lines.report</field>
            <field name="arch" type="xml">
                <search>
                    <field name="date"/>
                    <field name="user_id"/>
                    <field name="employee_id"/>
                    <field name="state"/>
                    <filter name="approved" string="Approved" domain="[('state','=','done')]"/>
                    <filter name="not_approved" string="Not Approved" domain="[('state','!=','done')]"/>
                    <filter name="this_week" string="This Week" domain="[('adv_search','=','this_week')]"/>
                    <filter name="last_week" string="Last Week" domain="[('adv_search','=','last_week')]"/>
                    <filter name="this_payperiod" string="This Payperiod" domain="[('adv_search','=','this_payperiod')]"/>
                    <filter name="prev_payperiod" string="Previous Payperiod" domain="[('adv_search','=','prev_payperiod')]"/>
                    <group expand="0" string="Group By">
                        <filter name="group_by_user" string="User" context="{'group_by':'user_id'}"/>
                        <filter name="group_by_employee" string="Employee" context="{'group_by':'employee_id'}"/>
                        <filter name="group_by_day" string="Day" context="{'group_by':'date:day'}"/>
                        <filter name="group_by_task_code" string="Task Code" context="{'group_by':'task_code'}"/>
                        <filter name="group_by_worktype" string="Worktype" context="{'group_by':'worktype'}"/>
                        <filter name="group_by_payperiod" string="Payperiod" context="{'group_by':'payperiod_id'}"/>
                    </group>
                </search>
            </field>
        </record>
        <record id="view_timekeeping_lines_report" model="ir.ui.view">
             <field name="name">hr.timekeeping.lines.graph</field>
             <field name="model">hr.timekeeping.lines.report</field>
             <field name="arch" type="xml">
                 <graph string="Timekeeping Entries Analysis" type="pivot">
                    <field name="employee_id" type="row"/>
                    <field name="payperiod_id" type="col"/>
                    <field name="unit_amount" type="measure"/>
                 </graph>
             </field>
        </record>
        <record id="action_timekeeping_lines_report" model="ir.actions.act_window">
            <field name="name">Timesheet Entries Report</field>
            <field name="res_model">hr.timekeeping.lines.report</field>
            <field name="view_type">form</field>
            <field name="view_mode">graph,tree</field>
            <field name="view_id" ref="view_timekeeping_lines_report"/>
            <field name="target">current</field>
            <field name="context">{'search_default_group_by_name':1}</field>
        </record>
        <menuitem id="menu_action_timekeeping_lines_report" action="action_timekeeping_lines_report" parent="menu_hr_timekeeping_reports"
                  groups="base.group_hr_user,imsar_timekeeping.group_pms_user" sequence="5"/>

        <!-- Inventory report -->
        <record id="view_timekeeping_inventory_wizard" model="ir.ui.view">
             <field name="name">hr.timekeeping.inventory.wizard</field>
             <field name="model">hr.timekeeping.inventory.wizard</field>
             <field name="arch" type="xml">
                <form string="Choose date range">
                    <group>
                        <field name="date_from"/>
                        <field name="date_to"/>
                    </group>
                    <footer>
                        <button name="open_report" string="Get Report" type="object"  class="oe_highlight"/>
                        or
                        <button string="Cancel" class="oe_link" special="cancel" />
                    </footer>
                </form>
             </field>
        </record>
        <record id="action_timekeeping_inventory_wizard" model="ir.actions.act_window">
            <field name="name">Inventory Report</field>
            <field name="res_model">hr.timekeeping.inventory.wizard</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_timekeeping_inventory_wizard"/>
            <field name="target">new</field>
        </record>
        <menuitem id="menu_action_timekeeping_inventory_wizard" action="action_timekeeping_inventory_wizard" parent="menu_hr_timekeeping_reports"
                  groups="base.group_hr_user" sequence="10"/>

        <!-- Sheets by week/task report -->
        <record id="view_timekeeping_by_task_wizard" model="ir.ui.view">
             <field name="name">hr.timekeeping.by_task.wizard</field>
             <field name="model">hr.timekeeping.by_task.wizard</field>
             <field name="arch" type="xml">
                <form string="Search by week and project">
                    <group>
                        <field name="week"/>
                        <field name="analytic" options="{'create': false, 'create_edit': false}" widget="selection"/>
                    </group>
                    <footer>
                        <button name="open_report" string="Get Report" type="object"  class="oe_highlight"/>
                        or
                        <button string="Cancel" class="oe_link" special="cancel" />
                    </footer>
                </form>
             </field>
        </record>
        <record id="action_timekeeping_by_task_wizard" model="ir.actions.act_window">
            <field name="name">Timesheets By Task Report</field>
            <field name="res_model">hr.timekeeping.by_task.wizard</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_timekeeping_by_task_wizard"/>
            <field name="target">new</field>
        </record>
        <menuitem id="menu_action_timekeeping_by_task_wizard" action="action_timekeeping_by_task_wizard" parent="menu_hr_timekeeping_reports"
                  groups="base.group_hr_user" sequence="15"/>

        <!-- Timesheet print report -->
        <report
            id="action_report_timekeeping_sheet_print"
            model="hr.timekeeping.sheet"
            string="Timesheet PDF"
            report_type="qweb-pdf"
            name="imsar_timekeeping.tk_print_report"
            file="tk_print_report"
        />
        <template id="tk_print_report">
            <t t-call="report.html_container">
                <t t-set="data_report_margin_top" t-value="8"/>
                <t t-set="data_report_header_spacing" t-value="8"/>
                <t t-foreach="docs" t-as="sheet">
                    <t t-call="imsar_timekeeping.timesheet_layout">
                        <div class="page">
                            <div class="row">
                                <div class="col-xs-3"><h1 t-esc="sheet.name"/></div>
                                <div class="col-xs-6 col-xs-offset-3 text-right"><h1 t-esc="sheet.employee_id.name"/></div>
                            </div>

                            <div class="row mt32">
                                <div class="col-xs-3">
                                    <strong>Dates:</strong>
                                    <p><span t-esc="sheet.date_from"/> to <span t-esc="sheet.date_to"/></p>
                                </div>
                                <div class="col-xs-3">
                                    <strong>Total Time:</strong>
                                    <p t-esc="sheet.total_time"/>
                                </div>
                                <div class="col-xs-3">
                                    <strong>Type:</strong>
                                    <p t-esc="sheet.type"/>
                                </div>
                                <div class="col-xs-3">
                                    <strong>Status:</strong>
                                    <p t-esc="sheet.state"/>
                                </div>
                            </div>

                            <h3>Task Lines</h3>
                            <table class="table table-condensed">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Category</th>
                                        <th>Task Code</th>
                                        <th>Description</th>
                                        <th>Hours</th>
                                        <th>Work Type</th>
                                        <th>Location</th>
                                    </tr>
                                </thead>
                                <tr t-foreach="sheet.line_ids" t-as="line">
                                    <td><span t-field="line.date"/></td>
                                    <td><span t-field="line.routing_id"/></td>
                                    <td><span t-field="line.routing_subrouting_id"/></td>
                                    <td><span t-field="line.name"/></td>
                                    <td><span t-field="line.unit_amount"/></td>
                                    <td><span t-field="line.worktype"/></td>
                                    <td><span t-field="line.location"/></td>
                                </tr>
                            </table>

                            <h3>Approval Lines</h3>
                            <table class="table table-condensed">
                                <thead>
                                    <tr>
                                        <th>Approval Type</th>
                                        <th>Contract/Project</th>
                                        <th>Status</th>
                                        <th>Approved By</th>
                                    </tr>
                                </thead>
                                <tr t-foreach="sheet.approval_line_ids" t-as="appr">
                                    <td><span t-field="appr.type"/></td>
                                    <td><span t-field="appr.account_analytic_id"/></td>
                                    <td><span t-field="appr.state"/></td>
                                    <td><span t-field="appr.approved_by"/></td>
                                </tr>
                            </table>

                            <h3>Logs</h3>
                            <table class="table table-condensed">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Author</th>
                                        <th>Subject</th>
                                        <th>Message</th>
                                    </tr>
                                </thead>
                                <tr t-foreach="sheet.message_logs" t-as="log">
                                    <td><span t-field="log.date"/></td>
                                    <td><span t-field="log.author_id"/></td>
                                    <td><span t-field="log.subject"/></td>
                                    <td><span t-field="log.body"/></td>
                                </tr>
                            </table>

                        </div>
                    </t>
                </t>
            </t>
        </template>

        <!-- footer layout for printed timesheets -->
        <template id="imsar_timekeeping.timesheet_layout">
            <!-- Multicompany -->
            <t t-if="o and 'company_id' in o">
                <t t-set="company" t-value="o.company_id"></t>
            </t>
            <t t-if="not o or not 'company_id' in o">
                <t t-set="company" t-value="res_company"></t>
            </t>

            <t t-raw="0" />
            <div class="footer">
                <div class="row">
                    <div class="col-xs-3">
                        <span>Printed on: </span>
                        <span t-esc="time.strftime('%Y-%m-%d')"/>
                        <span t-esc="time.strftime('%H:%M')"/>
                    </div>
                    <div class="col-xs-2 col-xs-offset-2 text-center">
                        <span t-esc="company.name"/>
                    </div>
                    <div class="col-xs-2 col-xs-offset-2 text-right">
                        <ul class="list-inline">
                            <li><span class="page"/></li>
                            <li>/</li>
                            <li><span class="topage"/></li>
                        </ul>
                    </div>
                </div>
            </div>
        </template>

    </data>
</openerp>

<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <!-- The time entry detail form -->
        <record id="hr_timekeeping_line_form" model="ir.ui.view">
            <field name="name">hr.timekeeping.line.form</field>
            <field name="model">hr.timekeeping.line</field>
            <field name="arch" type="xml">
                <form string="Timesheet Activities">
                    <group>
                        <group>
                            <field name="date" attrs="{'readonly':['|',('uid_is_user_id','!=',True),('sheet_state','!=','draft')]}"/>
                            <field name="name" attrs="{'readonly':['|',('uid_is_user_id','!=',True),('sheet_state','!=','draft')], 'required':['|',('unit_amount','!=',0.0)]}"/>
                            <field name="serial_reference" attrs="{'readonly':['|',('uid_is_user_id','!=',True),('sheet_state','!=','draft')]}"/>
                            <field name="unit_amount" widget="float_time" string="Hours" sum="Hours" help="Time (1:30) or float (1.5) format"
                                    attrs="{'readonly':['|',('uid_is_user_id','!=',True),('sheet_state','!=','draft')]}"/>
                            <field name="start_time" widget="time" attrs="{'readonly':['|',('uid_is_user_id','!=',True),('sheet_state','!=','draft')]}"/>
                            <field name="end_time" widget="time" attrs="{'readonly':['|',('uid_is_user_id','!=',True),('sheet_state','!=','draft')]}"/>
                            <field name="state" invisible="True"/>
                            <field name="logging_required" invisible="True"/>
                            <field name="amount" invisible="True" />
                            <field name="premium_amount" invisible="True" />
                            <field name="sheet_id" invisible="1"/>
                            <field name="user_id" invisible="1"/>
                            <field name="uid_is_user_id" invisible="1"/>
                            <field name="sheet_state" invisible="1"/>
                        </group>
                        <group>
                            <field name="dcaa_allowable" attrs="{'readonly':['|',('uid_is_user_id','!=',True),('sheet_state','!=','draft')]}"/>
                            <field name="routing_id" options="{'create': false, 'create_edit': false}" widget="selection"
                                   domain="[('section_ids','in',[%(imsar_timekeeping.ar_section_timekeeping)d])]"
                                   attrs="{'readonly':['|',('uid_is_user_id','!=',True),('sheet_state','!=','draft')]}"/>
                            <field name="routing_line_id" options="{'create': false, 'create_edit': false}" widget="selection" invisible="1"
                                    domain="[('routing_id','=',routing_id),('section_ids','in',[%(imsar_timekeeping.ar_section_timekeeping)d])]"/>
                            <field name="routing_subrouting_id" options="{'create': false, 'create_edit': false}" widget="selection"
                                    domain="[('routing_line_id','=',routing_line_id),('user_has_reviewed','=',True),('hide_from_uid','=',False),
                                    ('type','!=','view'),('dcaa_allowable','=',dcaa_allowable),('timesheets_future_filter','in',state)]" />
                            <field name="old_task_code" readonly="True" />
                            <field name="worktype" widget="selection" options="{'create': false, 'create_edit': false}"
                                   attrs="{'readonly':['|',('uid_is_user_id','!=',True),('sheet_state','!=','draft')]}"
                                    domain="[('task_worktype_search','=',routing_subrouting_id)]"/>
                            <field name="location" options="{'create': false, 'create_edit': false}"
                                   attrs="{'readonly':['|',('uid_is_user_id','!=',True),('sheet_state','!=','draft')]}"/>
                        </group>
                    </group>
                    <group attrs="{'invisible':['|',('uid_is_user_id','!=',True),('sheet_state','!=','draft')]}">
                        <field name="change_explanation" attrs="{'required':[('unit_amount','!=',0.0),('logging_required','=',True)],'invisible':[('logging_required','=',False)]}" widget="text"/>
                    </group>
                    <footer attrs="{'invisible':['|',('uid_is_user_id','!=',True),('sheet_state','!=','draft')]}">
                        <button name="write" type="object" string="Save" class="oe_highlight"/> or <button name="cancel" string="Cancel" special="cancel" class="oe_link"/>
                        <button name="unlink" string="Delete this entry" type="object" class="oe_right" confirm="Are you sure you want to delete this entry?" />
                    </footer>
                </form>
            </field>
        </record>
        <!-- Action for button of entry details-->
        <record id="action_timekeeping_line_details" model="ir.actions.act_window">
            <field name="name">Time Entry Details</field>
            <field name="res_model">hr.timekeeping.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="hr_timekeeping_line_form"/>
            <field name="target">new</field>
        </record>

        <!-- The main timesheet form -->
        <record id="hr_timekeeping_sheet_form" model="ir.ui.view">
            <field name="name">hr.timekeeping.sheet.form</field>
            <field name="model">hr.timekeeping.sheet</field>
            <field name="arch" type="xml">
                <form string="Timesheet" create="false" delete="false">
                <header>
                    <button name="button_confirm" string="Submit For Approval" type="object" class="oe_highlight oe_right"
                            attrs="{'invisible':['|',('state','!=','draft'),('uid_is_user_id','!=',True)]}"/>
                    <button name="button_self_cancel" string="Set back to Open" type="object" class="oe_right"
                            attrs="{'invisible':['|',('state','!=','confirm'),('uid_is_user_id','!=',True)]}"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,confirm,done" class="oe_left"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1><field name="employee_id" class="oe_inline" readonly="True"/></h1>
                        <field name="uid_is_user_id" invisible="True"/>
                    </div>
                    <group>
                        <group>
                            <field name="name"/>
                            <label for="date_from" string="Timesheet Period"/>
                            <div><field name="date_from" class="oe_inline"/> to <field name="date_to" class="oe_inline"/></div>
                            <button type="object" string="Previous Timesheet" name="button_previous_timesheet" />
                        </group>
                        <group>
                            <field name="employee_flsa_status" readonly="True"/>
                            <field name="type" string="Timesheet Type"/>
                            <field name="move_id" string="Journal Entry" attrs="{'invisible':[('state','!=','done')]}" groups="base.group_hr_user,account.group_account_user"/>
                            <field name="payroll_state" attrs="{'invisible':[('state','!=','done')]}" groups="base.group_hr_user"/>
                            <field name="payroll_comment" attrs="{'invisible':[('payroll_state','!=','failed')]}" groups="base.group_hr_user"/>
                        </group>
                    </group>
                    <group attrs="{'invisible':[('payroll_state','!=','failed')]}" groups="base.group_hr_user">
                        <button class="oe_highlight" type="object" string="Retry Payroll" name="button_retry_payroll" />
                    </group>
                    <group attrs="{'invisible':['|',('state','!=','done'),'|',('type','!=','regular'),('uid_is_user_id','!=',True)]}">
                        <button class="oe_highlight" type="object" string="Create/Edit Addendum" name="button_addendum" />
                    </group>
                    <group attrs="{'invisible':['|',('type','!=','addendum'),'|',('state','!=','done'),('payroll_state','!=','draft')]}" groups="base.group_hr_user">
                        <button class="oe_highlight" type="object" string="Mark as Submitted to Payroll" name="button_process_addendum" />
                    </group>
                    <notebook>
                        <!-- page for editable time entries -->
                        <page string="Entries" attrs="{'invisible':['|',('state','!=','draft'),('uid_is_user_id','!=',True)]}">
                            <button name="%(action_timekeeping_line_details)d" string="Add Entry" type="action"/>
                            <button name="write" type="object" string="Validate &amp; Save" class="oe_right"
                                    attrs="{'invisible':['|',('state','!=','draft'),('uid_is_user_id','!=',True)]}"/>
                            <div style="display: inline-block; width: 100px;"/>
                            <button name="button_oneclick_add" type="object" string="Add One-Click Tasks" class="oe_bounce_container"
                                    attrs="{'invisible':['|',('state','!=','draft'),'|',('type','!=','regular'),('uid_is_user_id','!=',True)]}"/>
                            <field name="line_ids" nolabel="1" attrs="{'readonly':['|',('uid_is_user_id','!=',True),('state','!=','draft')]}">
                                <tree string="Timesheet Activities" editable="top" create="false" delete="false"
                                    colors="black:display_color=='black';
                                            gray:display_color=='gray';
                                            maroon:display_color=='maroon';
                                            red:display_color=='red';
                                            purple:display_color=='purple';
                                            green:display_color=='green';
                                            olive:display_color=='olive';
                                            navy:display_color=='navy';
                                            teal:display_color=='teal';" >
                                    <field name="display_color" invisible="True"/>
                                    <field name="date" readonly="True"/>
                                    <field name="day_name" attrs="{'required':['|',('unit_amount','>',0.0)]}"/>
                                    <field name="routing_id" widget="selection" options="{'create': false, 'create_edit': false}"
                                           attrs="{'readonly':[('state','!=','open')]}"
                                           domain="[('section_ids','in',[%(imsar_timekeeping.ar_section_timekeeping)d])]" />
                                    <field name="routing_line_id" options="{'create': false, 'create_edit': false}" widget="selection"
                                           attrs="{'readonly':[('state','!=','open')]}" invisible="True"
                                           domain="[('routing_id','=',routing_id),('section_ids','in',[%(imsar_timekeeping.ar_section_timekeeping)d])]"/>
                                    <field name="routing_subrouting_id" options="{'create': false, 'create_edit': false}" widget="selection"
                                           attrs="{'readonly':[('state','!=','open')]}"
                                           domain="[('routing_line_id','=',routing_line_id),('user_has_reviewed','=',True),('hide_from_uid','=',False),
                                            ('type','!=','view'),('dcaa_allowable','=',dcaa_allowable),('timesheets_future_filter','in',state)]" />
                                    <field name="name" attrs="{'required':['|',('unit_amount','!=',0.0)], 'readonly':['|',('state','!=','open')]}"/>
                                    <field name="unit_amount" widget="float_time" string="Hours" sum="Hours"
                                           attrs="{'readonly':['|',('state','!=','open')]}"/>
                                    <button name="button_details" string="Details" type="object"
                                            attrs="{'invisible':['|',('sheet_state','!=','draft'),('uid_is_user_id','!=',True)]}"/>
                                    <!-- invisible fields -->
                                    <field name="dcaa_allowable" invisible="True"/>
                                    <field name="worktype" invisible="True" />
                                    <field name="state" invisible="True"/>
                                    <field name="sheet_state" invisible="True"/>
                                    <field name="date" invisible="True"/>
                                    <field name="logging_required" invisible="True"/>
                                    <field name="amount" invisible="True" />
                                    <field name="premium_amount" invisible="True" />
                                    <field name="change_explanation" invisible="True" />
                                    <field name="user_id" invisible="1"/>
                                    <field name="uid_is_user_id" invisible="1"/>
                                </tree>
                            </field>
                            <button name="%(action_timekeeping_line_details)d" string="Add Entry" type="action"/>
                        </page>
                        <!-- page for readonly time entries -->
                        <page string="Entries" attrs="{'invisible':[('state','=','draft'),('uid_is_user_id','=',True)]}">
                            <field name="view_line_ids" nolabel="1" readonly="True">
                                <tree string="Timesheet Activities" create="false" edit="false" delete="false"
                                    colors="black:display_color=='black';
                                            gray:display_color=='gray';
                                            maroon:display_color=='maroon';
                                            red:display_color=='red';
                                            purple:display_color=='purple';
                                            green:display_color=='green';
                                            olive:display_color=='olive';
                                            navy:display_color=='navy';
                                            teal:display_color=='teal';" >
                                    <field name="display_color" invisible="True"/>
                                    <field name="date" />
                                    <field name="day_name"/>
                                    <field name="routing_id"/>
                                    <field name="routing_line_id" invisible="True"/>
                                    <field name="routing_subrouting_id"/>
                                    <field name="name"/>
                                    <field name="unit_amount" widget="float_time" string="Hours" sum="Hours"/>
                                    <field name="worktype" />
                                </tree>
                            </field>
                        </page>
                        <!-- page for weekly summary -->
                        <page string="Summary" invisible="0">
                            <widget type="timekeeping_weekly_summary"/>
                        </page>
                        <!-- page for approvals -->
                        <page string="Approvals" attrs="{'invisible':[('state','=','draft')]}">
                            <field name="approval_line_ids" nolabel="1" readonly="True">
                                <tree editable="False">
                                    <field name="type"/>
                                    <field name="account_analytic_id"/>
                                    <field name="relevant_time" widget="float_time"/>
                                    <field name="state"/>
                                    <field name="approved_by" readonly="True"/>
                                    <field name="uid_can_approve" invisible="True"/>
                                    <button name="button_reject" string="Reject" class="oe_inline" type="object"
                                            attrs="{'invisible':['|',('state','!=','confirm'),('uid_can_approve','!=',True)]}"/>
                                    <button name="button_approve" string="Approve" class="oe_highlight" type="object"
                                            attrs="{'invisible':['|',('state','!=','confirm'),('uid_can_approve','!=',True)]}"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Instructions" attrs="{'invisible':[('state','!=','draft')]}">
                            <p><strong>How to keep time</strong></p>
                            <p>Timesheets are intended to be filled out every day, on the day  that work is done. You may edit entries for other days,
                            but you will typically be required to provide an explanation for the change. You may not create work entries for days
                            outside of this timesheet's work week.</p>
                            <p>First, you must review the Statement of Work for any task that you want to work on. The link to review task S.O.W.s is
                            on the left menu. Please read the description before clicking the acknowledgement button. Note that on the S.O.W. review page,
                            you may click the left and right buttons in the upper right corner to go to the previous/next S.O.W. page.</p>
                            <p>On the timesheet page, you may add new work entries with the "Add an item" link. You can set a default Billing Category
                            and/or Task on the Preferences page (left menu link). Additionally, you may only delete an entry from a line entry
                            Detail page.</p>
                            <p>Note that for any entries in the future, there is a very limited set of tasks that you may choose. (Typically
                            PTO and Holiday, under the Benefits category).</p>
                            <p>Entries edited in-line are not saved until you click Validate and Save! Make a habit of clicking this button frequently
                            so as not to lose data.</p>
                            <p><strong>Approvals</strong></p>
                            <p>Once your timesheet is completely filled out for a given week, click the red "Submit For Approval" button in the
                            upper right corner. The timesheet may no longer be edited while it's waiting for approval (or once approved).
                            While waiting for approval, you have the option to set the timesheet back to an Open state, but doing so
                            will reset all approval lines.</p>
                            <p>Every timesheet needs to be approved by at least two people: someone from HR and someone in your management chain.
                            Additionally, if you work on a contract or IRaD project, there will be additional approval lines added that must
                            be approved by a PM for that contract/project. Once all approval lines are approved, the timesheet goes into
                            a finished state, and it can no longer be edited in any way.</p>
                            <p><strong>Addendums</strong></p>
                            <p>When a timesheet is fully approved, an additional button will appear to make any work entry addendums, should
                            the need arise. A timesheet addendum is effectively the same as a regular timesheet, only without some of the
                            overtime rules for non-exempt employees. Negative hours are allowed. If you need to move hours from one
                            project to another, you would make two entries: one with negative hours on the incorrect task, and one
                            with positive hours on the correct task. The approval process for addendums is the same as for regular timesheets.</p>
                            <p>If an addendum is submitted with non-zero total hours, please notify HR so they can make the appropriate
                            payroll adjustments!</p>
                        </page>
                    </notebook>
                    <group>
                        <!--<field name="subtotal_line" attrs="{'invisible':[('employee_flsa_status','=','exempt')]}"/>-->
                        <field name="subtotal_line"/>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_ids" widget="mail_thread"/>
                    <field name="message_follower_ids" widget="mail_followers"/>
                </div>
                </form>
            </field>
        </record>

        <!-- The time entry reject form -->
        <record id="hr_timekeeping_reject_form" model="ir.ui.view">
            <field name="name">hr.timekeeping.comment.form</field>
            <field name="model">hr.timekeeping.comment</field>
            <field name="arch" type="xml">
                <form string="Timesheet Activities">
                    <group>
                        <!--<field name="sheet_id" invisible="True"/>-->
                        <field name="comment" widget="text"/>
                    </group>
                    <footer>
                        <button string="Submit" name="submit_explanation" type="object" class="oe_highlight"/>
                        or
                        <button string="Cancel" class="oe_link" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>
        <!-- Action for reject approval button -->
        <record id="action_timekeeping_reject_form" model="ir.actions.act_window">
            <field name="name">Reject Timesheet</field>
            <field name="res_model">hr.timekeeping.comment</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="hr_timekeeping_reject_form"/>
            <field name="target">new</field>
        </record>

        <!-- search filters -->
        <record id="view_hr_timekeeping_sheet_filter" model="ir.ui.view">
            <field name="name">hr.timekeeping.sheet.filter</field>
            <field name="model">hr.timekeeping.sheet</field>
            <field name="arch" type="xml">
                <search string="Search Timesheet">
                    <filter name="draft" string="In Draft" domain="[('state','=','draft')]"/>
                    <filter name="to_approve" string="To Approve" domain="[('state','=','confirm')]"/>
                    <filter name="my_approvals" string="My Approvals" domain="[('adv_search','=','my_approvals')]"/>
                    <filter name="my_direct_approvals" string="My Direct Approvals" domain="[('adv_search','=','my_direct_approvals')]"/>
                    <filter name="my_user_id" string="My Timesheets" domain="[('user_id','=',uid)]"/>
                    <filter name="this_week" string="This Week" domain="[('adv_search','=','this_week')]"/>
                    <filter name="this_payperiod" string="This Payperiod" domain="[('adv_search','=','this_payperiod')]"/>
                    <filter name="prev_payperiod" string="Previous Payperiod" domain="[('adv_search','=','prev_payperiod')]"/>
                    <filter name="pending_payroll" string="Pending Payroll" domain="[('state','=','done'),('payroll_state','!=','submitted')]"/>
                    <group expand="0" string="Group By">
                        <filter name="group_by_employee" string="Employees" icon="terp-personal" context="{'group_by':'employee_id'}"/>
                        <filter name="group_by_name" string="Sheet Name" icon="terp-personal" context="{'group_by':'name'}"/>
                        <filter name="group_by_payperiod" string="Pay Period" icon="terp-personal" context="{'group_by':'payperiod_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Menus and stuff -->
        <menuitem id="menu_hr_timekeeping" name="Time Keeping" parent="hr.menu_hr_root" sequence="1" groups="base.group_user,base.group_hr_user,base.group_hr_manager"/>
        <menuitem id="hr.menu_hr_main" name="Human Resources" parent="hr.menu_hr_root" sequence="10"/>
        <menuitem id="menu_hr_timekeeping_reports" name="Reporting" parent="hr.menu_hr_root" sequence="20" groups="base.group_hr_user,base.group_hr_manager"/>

        <!-- My Current Timesheet menuitem -->
        <record id="action_hr_timekeeping_current_open" model="ir.actions.server">
            <field name="sequence" eval="5"/>
            <field name="state">code</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="model_hr_timekeeping_current_open"/>
            <field name="code">action = pool.get('hr.timekeeping.current.open').open_timesheet(cr, uid, None, context)</field>
            <field name="condition">True</field>
            <field name="name">My Current Timesheet</field>
        </record>
        <menuitem id="menu_act_hr_timekeeping_my_current" action="action_hr_timekeeping_current_open" parent="menu_hr_timekeeping" sequence="1"/>

        <!-- Addendum Timesheet -->
        <record id="action_hr_timekeeping_addendum_open" model="ir.actions.server">
            <field name="sequence" eval="5"/>
            <field name="state">code</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="model_hr_timekeeping_addendum_open"/>
            <field name="code">action = pool.get('hr.timekeeping.addendum.open').open_addendum(cr, uid, context)</field>
            <field name="condition">True</field>
            <field name="name">Timesheet Addendum</field>
        </record>

        <!-- Previous timesheets -->
        <record id="past_timesheet_tree" model="ir.ui.view">
            <field name="name">hr.timekeeping.sheet.tree</field>
            <field name="model">hr.timekeeping.sheet</field>
            <field name="arch" type="xml">
                <tree string="Timesheets" create="false" edit="false" delete="false"
                      colors="red:payroll_state=='failed';red:type=='addendum';">
                    <field name="employee_id" />
                    <field name="name" />
                    <field name="date_from" />
                    <field name="date_to" />
                    <field name="total_time" widget="float_time" />
                    <field name="type" />
                    <field name="state" />
                    <field name="payroll_state"/>
                </tree>
            </field>
        </record>
        <record id="past_timesheets_view_form" model="ir.actions.act_window">
            <field name="name">My Timesheets</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.timekeeping.sheet</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" eval="hr_timekeeping_sheet_form"/>
            <field name="domain">[('user_id','=',uid)]</field>
        </record>
        <record id="action_past_timesheets_tree" model="ir.actions.act_window.view">
            <field name="view_mode">tree</field>
            <field name="view_id" ref="past_timesheet_tree"/>
            <field name="act_window_id" ref="past_timesheets_view_form"/>
        </record>
        <record id="all_timesheets_view_form" model="ir.actions.act_window">
            <field name="name">All Timesheets</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.timekeeping.sheet</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" eval="hr_timekeeping_sheet_form"/>
            <field name="context">{'search_default_group_by_name':1}</field>
        </record>
        <record id="action_all_timesheets_tree" model="ir.actions.act_window.view">
            <field name="view_mode">tree</field>
            <field name="view_id" ref="past_timesheet_tree"/>
            <field name="act_window_id" ref="all_timesheets_view_form"/>
        </record>
        <menuitem id="menu_past_timesheets_view" action="past_timesheets_view_form" parent="menu_hr_timekeeping" name="My Timesheets" sequence="2"/>
        <menuitem id="menu_all_timesheets_view" action="all_timesheets_view_form" parent="menu_hr_timekeeping_reports" name="All Timesheets" sequence="2"/>

        <!-- Need My Approval -->
        <record id="timesheets_approvals_view_form" model="ir.actions.act_window">
            <field name="name">My Approvals</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.timekeeping.sheet</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('adv_search','=','my_approvals')]</field>
            <field name="view_id" eval="hr_timekeeping_sheet_form"/>
        </record>
        <record id="action_timesheets_approvals_tree" model="ir.actions.act_window.view">
            <field name="view_mode">tree</field>
            <field name="view_id" ref="past_timesheet_tree"/>
            <field name="act_window_id" ref="timesheets_approvals_view_form"/>
        </record>
        <menuitem id="menu_act_hr_timekeeping_my_approval_filter" action="timesheets_approvals_view_form" parent="menu_hr_timekeeping" sequence="3"/>

        <!-- Timekeeping user preferences -->
        <record id="user_preferences_form" model="ir.ui.view">
            <field name="name">timekeeping.preferences.form</field>
            <field name="model">hr.timekeeping.preferences</field>
            <field name="arch" type="xml">
                <form string="Timesheet" create="false" delete="false">
                    <sheet>
                        <group string="Default Category/Task">
                            <field name="routing_id" widget="selection" options="{'create': false, 'create_edit': false}"
                                   domain="[('section_ids','in',[%(imsar_timekeeping.ar_section_timekeeping)d])]" />
                            <field name="routing_line_id" options="{'create': false, 'create_edit': false}" widget="selection" invisible="1"
                                   domain="[('routing_id','=',routing_id),('section_ids','in',[%(imsar_timekeeping.ar_section_timekeeping)d])]"/>
                            <field name="routing_subrouting_id" options="{'create': false, 'create_edit': false}" widget="selection"
                                   domain="[('routing_line_id','=',routing_line_id),('user_has_reviewed','=',True)]" />
                        </group>
                        <group string="One-Click Tasks">
                            <field name="oneclick_tasks" nolabel="1" domain="[('oneclick_filter','=',True)]"
                                   options="{'create': false, 'create_edit': false}" >
                                <tree colors="black:display_color=='black';
                                            gray:display_color=='gray';
                                            maroon:display_color=='maroon';
                                            red:display_color=='red';
                                            purple:display_color=='purple';
                                            green:display_color=='green';
                                            olive:display_color=='olive';
                                            navy:display_color=='navy';
                                            teal:display_color=='teal';" >
                                    <field name="display_color" invisible="True"/>
                                    <field name="routing_id" string="Category"/>
                                    <field name="name" string="Task Code"/>
                                </tree>
                            </field>
                        </group>

                    </sheet>
                </form>
            </field>
        </record>
        <record id="action_user_preferences_form" model="ir.actions.server">
            <field name="sequence" eval="5"/>
            <field name="state">code</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="model_hr_timekeeping_current_open"/>
            <field name="code">action = pool.get('hr.timekeeping.current.open').open_preferences(cr, uid, None, context)</field>
            <field name="condition">True</field>
            <field name="name">Preferences</field>
        </record>
        <menuitem id="menu_user_preferences_form" action="action_user_preferences_form" parent="menu_hr_timekeeping" sequence="7"/>

        <!-- Send timesheets to payroll processing -->
        <record id="timesheet_send_to_payroll_view" model="ir.ui.view">
            <field name="name">hr.timekeeping.sheet.payroll.form</field>
            <field name="model">hr.timekeeping.sheet.payroll.confirm</field>
            <field name="arch" type="xml">
                <form string="Confirm Payroll Submission">
                    <p class="oe_grey">
                        Submit the selected timesheets for payroll processing.
                    </p>
                    <footer>
                        <button string="Submit" name="submit_confirm" type="object" default_focus="1" class="oe_highlight"/>
                        or
                        <button string="Cancel" class="oe_link" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>
        <!-- Puts an option in the More button that calls a wizard -->
        <act_window id="timesheet_send_to_payroll" name="Submit to Payroll"
            res_model="hr.timekeeping.sheet.payroll.confirm" src_model="hr.timekeeping.sheet"
            multi="True" key2="client_action_multi"
            view_mode="form" target="new" view_type="form"
            groups="base.group_hr_user" />

        <!-- Pay periods -->
        <record id="payperiod_tree" model="ir.ui.view">
            <field name="name">hr.timekeeping.payperiod.tree</field>
            <field name="model">hr.timekeeping.payperiod</field>
            <field name="arch" type="xml">
                <tree string="Pay Periods" >
                    <field name="name" />
                    <field name="start_date" />
                    <field name="end_date" />
                    <field name="pay_date" />
                </tree>
            </field>
        </record>
        <record id="payperiod_form" model="ir.ui.view">
            <field name="name">hr.timekeeping.payperiod.form</field>
            <field name="model">hr.timekeeping.payperiod</field>
            <field name="arch" type="xml">
                <form string="Pay Periods" >
                    <group>
                        <group>
                            <field name="year" />
                            <field name="period_num" />
                        </group>
                        <group>
                            <field name="start_date" />
                            <field name="end_date" />
                            <field name="pay_date" />
                        </group>
                    </group>
                </form>
            </field>
        </record>
        <record id="payperiod_view" model="ir.actions.act_window">
            <field name="name">Pay Periods</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.timekeeping.payperiod</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" eval="payperiod_tree"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Create Pay Periods to give timesheets payroll context.
              </p>
            </field>
        </record>
        <menuitem id="menu_payperiod_view" action="payperiod_view" parent="hr.menu_hr_configuration" name="Pay Periods" sequence="5"/>

        <!-- Timesheet lines for inventory report -->
        <record id="timesheet_inventory_report_tree" model="ir.ui.view">
            <field name="name">hr.timekeeping.line.inventory.tree</field>
            <field name="model">hr.timekeeping.line</field>
            <field name="arch" type="xml">
                <tree string="Timesheet lines" >
                    <field name="user_id" />
                    <field name="date" />
                    <field name="name" />
                    <field name="serial_reference" />
                    <field name="routing_id" />
                    <field name="routing_subrouting_id" />
                    <field name="unit_amount" string="Hours"/>
                    <field name="full_amount" />
                </tree>
            </field>
        </record>


    </data>
</openerp>
